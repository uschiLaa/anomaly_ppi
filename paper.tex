% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  12pt]{article}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\addtolength{\oddsidemargin}{-.5in}%
\addtolength{\evensidemargin}{-1in}%
\addtolength{\textwidth}{1in}%
\addtolength{\textheight}{1.7in}%
\addtolength{\topmargin}{-1in}%
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{float}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage{bm}
\def\tightlist{}
\usepackage{setspace}
\newcommand\pD{$p\text{-}D$}
\newcommand\kD{$k\text{-}D$}
\newcommand\dD{$d\text{-}D$}
\newcommand\gD{$2\text{-}D$}
\newcommand\bD{$1\text{-}D$}
\newtheorem*{theorem}{Theorem}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{agsm}
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Is this normal? A new projection pursuit index to assess a sample against a multivariate null distribution},
  pdfauthor={Annalisa Calvi; Ursula Laa; Dianne Cook},
  pdfkeywords={exploratory data analysis, statistical
graphics, dimension reduction, high-dimensional visualisation, climate
change, clinical trials},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\begin{document}


\def\spacingset#1{\renewcommand{\baselinestretch}%
{#1}\small\normalsize} \spacingset{1}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{\bf Is this normal? A new projection pursuit index to assess a
sample against a multivariate null distribution}
\author{
Annalisa Calvi\\
School of Mathematics, Monash University\\
and\\Ursula Laa\\
Institute of Statistics, University of Natural Resources and Life
Sciences, Vienna\\
and\\Dianne Cook\\
Department of Econometrics and Business Statistics, Monash University\\
}
\maketitle

\bigskip
\bigskip
\begin{abstract}
Many data problems contain some reference or normal conditions, upon
which to compare newly collected data. This scenario occurs in data
collected as part of clinical trials to detect adverse events, and or
for measuring climate change against historical norms. The data is
typically multivariate, and often the normal ranges are specified by a
multivariate normal distribution. The work presented in this paper
develops methods to compare the new sample against the reference
distribution with high-dimensional visualisation. It uses a projection
pursuit guided tour to produce a sequence of low-dimensional projections
steered towards those where the new sample is most different from the
reference. A new projection pursuit index is defined, and the drawing of
the projected ellipse is computed analytically. The methods are
implemented in the R package, \texttt{tourr}.
\end{abstract}

\noindent%
{\it Keywords:} exploratory data analysis, statistical
graphics, dimension reduction, high-dimensional visualisation, climate
change, clinical trials
\vfill

\newpage
\spacingset{1.9} % DON'T change the spacing!

\section{Introduction}\label{introduction}

Linear projections are useful in many aspects of statistical analysis of
multivariate data, and especially useful for visualising the data. A
linear projection provides a dimension reduction while maintaining
interpretability. For example, a biplot \citep{Ga71, GH96} shows the
structure creating the maximum variance in the data, and also
visualizing the projection matrix to learn which variables contribute to
it. We might find clusters of outliers that were hiding in high
dimensions.

More generally, projection pursuit \citep{FT74, JS87, Hu85} defines a
quantitative criterion for the interestingness of a projection (a
projection pursuit index), and searches the space of possible
projections for the most interesting one to display. We can also define
sequences of interpolated linear projections to better understand a
multivariate distribution. Animating a randomly selected interpolated
sequence of linear projections is called a grand tour
\citep{As85, BA86b, BCAH05, CLBW06, tours2022}. The combination of these
two approaches would then use a projection pursuit index to select
interesting projections, but display them via an interpolated path to
provide context. This is called a guided tour \citep{cook1995}.

The question is whether we can use these techniques to assess new data
samples in the context of an established normal, such as a specific
multivariate normal distribution. In physics, the normal distribution
may describe experimental results, or a global fit for a selected model,
and we might want to compare to a set of other models. In medical
applications, the normal distribution might summarize historic data of a
healthy population and we compare it to samples from new patients. In
outlier detection we might use robust measures to define the normal
distribution and look for anomalies.

This paper describes a new projection pursuit index which is optimized
by projections where a new sample is most distant from the existing
normal distribution. It is organised as follows.
Section~\ref{sec-background} provides more context for the methods and
visualisation. Section~\ref{sec-anomaly-index} provides the details of
the new index, and example use is illustrated in
Section~\ref{sec-examples}.

\section{Background}\label{sec-background}

To compare a new sample with an existing norm, like a multivariate
normal distribution, in higher than two dimensions, we have typically
used two samples of points. The norm is represented by points on the
surface of a \(p\)-dimensional ellipsoid, corresponding to a confidence
level. A sample of points uniformly distributed on a \(p\)-dimensional
sphere is generated by

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Simulating a sample of observations (\(\mathbfit{x}\), which are \pD{}
  vectors) from \(N_p(\mathbfit{\mu}, \Sigma)\).
\item
  Transforming each observation to have unit distance from the mean,
  \(\frac{\mathbfit{x}^\top}{||\mathbfit{x}^\top||}\). To convert this
  to points on the surface of a confidence ellipsoid,
\item
  transform the shape using a specific variance covariance, and shift to
  center on the mean vector.
\end{enumerate}

Finally, new observations can be visually compared with this ellipsoid
by

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  plotting them together.
\end{enumerate}

Figure~\ref{fig-ci} illustrates this process for \gD. This is easiest
way to view this normal region relative to a new sample for any \pD{}
problem.

\begin{figure}

\centering{

\includegraphics[width=1\textwidth,height=\textheight]{paper_files/figure-pdf/fig-ci-1.pdf}

}

\caption{\label{fig-ci}Simulating a uniform sample on a sphere involves
sampling from a multivariate normal (a) and transforming each
observation to have length equal to 1. A confidence ellipsoid is
generated by transforming the sphere relative to a specified
variance-covariance matrix (c), and new observations can be visually
assessed to be inside or outside by plotting with the ellipsoid (d).}

\end{figure}%

For example, Figure~\ref{fig-compare} compares a new sample of patient
scores against the normal range represented by an ellipse (a) and also
against a simulated sample of normal patients (b). While these are
useful approaches, the ragged edges of the projected ellipse make it
difficult to compare the new sample precisely agains the normal ranges.

\begin{figure}

\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=2.60417in,height=\textheight]{images/example1.png}

}

\subcaption{\label{fig-compare1}Relative to confidence ellipse.}

\end{minipage}%
%
\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=2.60417in,height=\textheight]{images/example2.png}

}

\subcaption{\label{fig-compare}Relative to normal patients.}

\end{minipage}%

\caption{\label{fig-compare}Illustration of current procedure: (a)
compare new sample with points of the surface of a \(p\text{-}D\)
ellipse, (b) compare new sample with a simulated sample of normal
patients. Although both approaches are useful, the rough edges of the
projected ellipse points makes it difficult to precisely assess the
positions of the new sample against the normal bounds.}

\end{figure}%

Although this is flexible, this does not make it easy to guide the tour
towards the directions (projections) where the samples are most
different from the normal. What would be desirable is to analytically
define the confidence ellipsoid, compute flag observations that are
outside, steer the tour to projections that reveal the extent of the
difference. And also display the projected ellipsoid as a geometric
shape rather than a sample of points. These are the procedures that are
described in the next section.

\section{Anomaly index}\label{sec-anomaly-index}

\subsection{Projecting an ellipsoid}\label{projecting-an-ellipsoid}

A \pD{} ellipsoid corresponding to a given variance-covariance
(\(\Sigma\)) is defined by

\[
(\mathbfit{x}-\mathbfit{\mu}) \Sigma^{-1}(\mathbfit{x}-\mathbfit{\mu})^T = c^2
\] where \(c\) a constant that depends on a specific confidence level.

\begin{theorem}
  The projection of this \pD{} ellipsoid in \gD{} has the equation
$$(\mathbfit{y} - \mathbfit{\mu}_p)(P^T \Sigma P)^{-1}(\mathbfit{y} - \mathbfit{\mu}_p)^T = c^2.$$
\end{theorem}
\begin{proof}
The projection of an ellipsoid onto \gD{} is an ellipse, where the curve of the ellipse is defined through the set of points $\mathbfit{x}$ for which the gradient is parallel to the projection plane. That is, the curve 
consists of $\mathbfit{x}$ satisfying

$$\nabla (\mathbfit{x}-\mathbfit{\mu}) \Sigma^{-1}(\mathbfit{x}-\mathbfit{\mu})^T = 2 (\mathbfit{x}-\mathbfit{\mu}) \Sigma^{-1} = 2\mathbfit{s}P^T
$$

for some $\mathbfit{s} \in \mathbb{R}^2$, where $P$ is a $(p\times 2)$ orthonormal basis defining the
projection. We can write $\mathbfit{x}-\mathbfit{\mu} = \mathbfit{s} P^T \Sigma$.
Making this substitution in the \pD{} ellipsoid equation yields

$$c^2 = (\mathbfit{x}-\mathbfit{\mu}) \Sigma^{-1}(\mathbfit{x}-\mathbfit{\mu})^T = \mathbfit{s} P^T \Sigma P \mathbfit{s}^T
$$

We call points in the projection that are on the curve $\mathbfit{y}$, so that $\mathbfit{y} = \mathbfit{x}P$ for $\mathbfit{x}$ on the \pD{} curve. Then $\mathbfit{y} - \mathbfit{\mu}_p = (\mathbfit{x} - \mathbfit{\mu})P = \mathbfit{s} P^T \Sigma P$, where $\mathbfit{\mu}_p = \mathbfit{\mu} P$ is the projected mean. We then substitute $(\mathbfit{y} - \mathbfit{\mu}_p) (P^T \Sigma P)^{-1}$ for $\mathbfit{s}$ in the equation \(c^2 = \mathbfit{s} P^T \Sigma P \mathbfit{s}^T\). From this we can compute the analog equation for the projection as

$$(\mathbfit{y} - \mathbfit{\mu}_p)(P^T \Sigma P)^{-1}(\mathbfit{y} - \mathbfit{\mu}_p)^T = c^2$$

as claimed.
\end{proof}

This means the matrix \((P^T \Sigma P)^{-1}\) is defining the ellipse in
the \gD{} projection. In general \(c\) could be any constant, but
typically we would select it as a quantile of the \(\chi^2\)
distribution, so that the size of the ellipse corresponds to a selected
probability.

\subsection{Index specification}\label{index-specification}

To define a measure of an interesting projection is to maximize the
average Mahahlanobis distance \citep{mahalanobis} in the projection for
a subset of points, \(W\). The set of points could be chosen in
different ways, but the default is those that are outside the specified
ellipsoid in \pD{}. Alternatives could be to select a set of
observations with the largest Mahalanobis distance, manually select
observations or possibly a group of points identified via clustering of
the extremes.

The index is written as

\[
\sum_{\mathbfit{w} \in W} (\mathbfit{w} - \mathbfit{\mu}) P (P^T\Sigma P)^{-1}P^T(\mathbfit{w} - \mathbfit{\mu})^T
\]

where by default
\(W = \{\mathbfit{x}: (\mathbfit{x}-\mathbfit{\mu}) \Sigma^{-1}(\mathbfit{x}-\mathbfit{\mu})^T > c^2\}\),
is the set of observations outside the \pD{} ellipsoid.

\subsection{Additional considerations}\label{additional-considerations}

If the observations in \(W\) are primarily departing from the normal
range in the same direction, the index will be expected to perform well
in finding this average direction. However, if the observations have
very different departures from the norm, it may be useful to break them
into groups, and separately optimize on these subsets. One could
consider clustering these observations using angular distance to find
groups of observations that have similar directions of departure.

\section{Implementation}\label{implementation}

This is implemented in the \texttt{tourr} \citep{tourr, tourr-cran}
package, where the projected ellipsoid can be drawn for each projection.
The guided tour will take arguments specifying the data, and the null
variance-covariance matrix.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tourr)}
\FunctionTok{animate\_xy}\NormalTok{(samp, }\FunctionTok{guided\_anomaly\_tour}\NormalTok{(}\FunctionTok{anomaly\_index}\NormalTok{(),}
  \AttributeTok{ellipse=}\NormalTok{vc\_null), }\AttributeTok{ellipse=}\NormalTok{vc\_null, }
  \AttributeTok{axes =} \StringTok{"bottomleft"}\NormalTok{, }\AttributeTok{half\_range=}\DecValTok{5}\NormalTok{, }\AttributeTok{center=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/anomaly1.png}

}

\subcaption{\label{fig-anomaly1}Random projection}

\end{minipage}%
%
\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/anomaly2.png}

}

\subcaption{\label{fig-anomaly2}Optimal projection}

\end{minipage}%

\caption{\label{fig-anomaly}Two projections of simulated example data
corresponding to the sample code: (a) random projection where sample is
inside the 2-D ellipse, (b) optimal projection from index, showing most
of the sample outside. A red cross indicates that the point is outside
the p-D ellipse. The optimal projection uses mostly variables
\(x_4, x_5\), which is expected because these are the two directions
where the sample most differs from the norm.}

\end{figure}%

\section{Examples}\label{sec-examples}

\subsection{Health: liver function
tests}\label{health-liver-function-tests}

This example is motivated by a problem posed during consulting with a
pharmaceutical company, but the data shown here is simulated, simply to
illustrate the application. Liver function tests commonly provide
measurements on albumin, protein, bilirubin, gamma-glutamyl- transferase
(GGT), aspartate aminotransferase (AST), alkaline phosphatase (ALP) and
alanine aminotransferase (ALT). There are normal ranges on these
measurements reported by \citet{lib-med-liver-norms} and listed in
Table~\ref{tbl-liver-norms}.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0421}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1474}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1474}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.2000}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1158}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1158}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1158}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1158}}@{}}

\caption{\label{tbl-liver-norms}Normal ranges provided for liver
function tests.}

\tabularnewline

\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
albumin (g/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
protein (g/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
bilirubin (µmol/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
GGT (IU/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
AST (IU/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
ALP (IU/L)
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
ALT (IU/L)
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
min & 35 & 60 & 0 & 2 & 5 & 30 & 5 \\
max & 50 & 80 & 20 & 44 & 30 & 120 & 40 \\

\end{longtable}

These measurements are also likely correlated, based on guidance like
the \emph{ratio of AST to ALT of 2:1 indicates possible alcohol abuse}.
Although this was provided by the pharmaceutical company, correlation
between these measurements for normal patients is not readily available.
When a correlation matrix for normal patients is provided this would
allow construction of the null ellipse upon which to examine new
samples.

Figure~\ref{fig-liver} illustrates two examples. The first is similar to
the consulting project. A sample of liver test scores for new patients
was provided in order to examine their values relative to the normal
range. Here only four tests are used, GGT, AST, ALP, ALT. Plot (a) shows
a projection of this sample relative to the normal range. Three of the
patients are outside the confidence ellipse but all of the patients are
located away from the mean. What has been typical in the past is to
compute normal values based on tests of healthy young males. The samples
provided for the project were all recorded on women. We see that this
sample has slightly lower ALT and ALP, which is consistent with what is
reported in \citet{lib-med-liver-norms}.

The second example shows a longitudinal record of a single patient,
measured at ages 45, 50, 55, 65 and 70. The lines connect the records in
time order. The projection corresponds to the maxima from a
projection-pursuit guided tour using the anomaly index:

\[
P = \left[ \begin{array}{rr}
            0.371 & -0.128 \\
            -0.388 & 0.732 \\
            0.140 & 0.599 \\
            -0.832 & -0.297 
            \end{array} \right]
\]

From the axes representation in Figure~\ref{fig-liver} (b) of this
projection, we can see that the direction that profile extends is
primarily contrasting ALT (fourth row) and ALP (third row). This is
consistent with aging, where ALP increases and ALT decreases.

\begin{figure}

\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/liver1.png}

}

\subcaption{\label{fig-liver1}Sample of female patients}

\end{minipage}%
%
\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/liver2.png}

}

\subcaption{\label{fig-liver2}Longitudinal profile of an aging patient}

\end{minipage}%

\caption{\label{fig-liver}Two projections of simulated example data
corresponding to common liver tests: (a) sample of female patients, (b)
longitudinal test results for a single patient. Red cross indicates
observation is outide the 4-D confidence ellipse. The female patients
tend to have lower ALP and ALT than the normal range. As the patient
ages, the level of ALP increases and ALT decreases.}

\end{figure}%

\subsection{Robust statistics: weather
extremes}\label{robust-statistics-weather-extremes}

This example is motivated by the weather data example from
\citet{filzmoser2018}. We illustrate using the anomaly index to compare
potential outliers with a reference normal distribution that is derived
using robust methods on the original data. The data contains 16
numerical measurements that are averages across the three summer months
June, July and August, reported for 68 years (1955 - 2022) (see
\citet{filzmoser2018} for more details).

To estimate the underlying normal distribution the data is first
centered and scaled using the median and the median absolute deviation
(MAD), before applying the minimum covariance determinant (MCD)
estimator \citep{rousseeuw1985multivariate} using the implementation in
\citet{robustbase}. The MCD estimates for the mean vector and the
variance-covariance matrix are then used to define the reference normal
distribution.

Here we will consider points to be outlying if they are more than
\(5 \sigma\) away from that mean value. With \(p=16\) this corresponds
to a Mahalanobis distance of \(60\) or larger. This will identify \(20\)
out of the \(68\) observations as outlying. Since these are outlying in
different combinations of variables, as found in \citet{filzmoser2018},
we will further separate the outlying points into clusters based on
similarity in direction. The similarity is computed by first normalizing
observations to have length \(1\) and then apply k-means clustering with
Euclidean distance. We use the Dunn index \citet{dunn}, computed using
\citet{fpc}, to select the preferred number of clusters, \(k=5\).

The new anomaly index is first applied to the full dataset, such that
the final projection will be affected by averaging distance of points in
many directions, see Fig. Figure~\ref{fig-weather} (a). It provides a
global picture showing where the outlying points differ from the normal
distribution. We can see that the contrast between maximum (atmx) and
minimum (atmn) temperature is primarily used in the direction where
points are most outlying. In the orthogonal direction the variables
precipitation (prc) and number of days with maximum temperature above
25°C (nsm) can be used to separate the clusters 2, 3 and 5. With this
solution the two points in cluster 4 cannot be resolved, they fall
inside the ellipse. To better understand what is different for those two
years we separately run the anomaly index for this subset, see Fig.
Figure~\ref{fig-weather} (b). From the result we see that the maximum
temperature is not relevant for this cluster, but that they have low
values for the minimum temperature. We also see that there is still some
averaging, and the preferred solution is not placing either point on the
outside of the projected ellipse.

\begin{figure}

\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/weather1.png}

}

\subcaption{\label{fig-weather1}All outlying points clustered}

\end{minipage}%
%
\begin{minipage}{0.50\linewidth}

\centering{

\includegraphics[width=3.125in,height=\textheight]{images/weather2.png}

}

\subcaption{\label{fig-weather2}Only cluster 4}

\end{minipage}%

\caption{\label{fig-weather}Examining weather anomalies using
projections identified by the anomaly index: (a) computed on all
outlying points, (b) computed only for cluster 4. In (a) the outlying
points are somewhat orthogonal to the normal ellipse, which is primarily
using the temperature min (\texttt{atmn}) and max (\texttt{atmx})
variables. In (b) the two observations are primarily extreme in the
minimum temperature (\texttt{atmn}) variable, and have lower than normal
minima.}

\end{figure}%

To compare our results to what is obtained by outlier detection methods,
we reproduce one of the results from \citet{filzmoser2018} in
Figure~\ref{fig-shapley}. On top we can see the cluster assignments for
all points that we have identified as outliers using the
\(p\)-dimensional Mahalanobis distance.

For example we see that cluster 4 contains the years 1962 and 1996, and
for these two years the result from \citet{filzmoser2018} also indicates
unusually low values for the minimum teperature, while there is
disagreement between outlyingness in other variables. Note that compared
to the years 1965 and 1966 they have unusually low minimum temperature
while having average values for the number of days with maximum
temparature above 25°C, and this contrast is also captured in the
projection.

When looking at the overall picture (Fig. Figure~\ref{fig-weather} (a)),
we can see that the linear projection is showing the difference between
minimum and maximum temperature, which is where clusters are outlying in
different directions. The direction of cluster 1 is where the average
maximum temperature is unusually higher compared to the minimum
temperature, while clusters 3 corresponds to years where the minimum
temperature is unusually close to the maximum temperature. This combined
information cannot be resolved with the cell detection algorithm, but we
see that for example the most recent years (cluster 3) were tagged for
having unusually high values for both the minimum and the maximum
temperature.

\begin{figure}

\centering{

\includegraphics[width=6.25in,height=\textheight]{images/weather3.png}

}

\caption{\label{fig-shapley}Reproduction of the results from
\citet{filzmoser2018}, showing which cells have been identified as
outlying by their Shapley Cell Detector algorithm. Red cells indicate
values higher than expected, blue cells values lower than expected. For
years that have been identified as outliers in our approach we show the
cluster assignment at the top.}

\end{figure}%

\section{Conclusion}\label{conclusion}

This paper has provided a new projection pursuit index for comparing a
sample of data against a multivariate normal reference distribution. It
has also provided an analytical result for drawing \gD{} projections of
the \pD{} ellipse corrsponding to the normal reference distribution.
These combined provide new ways to visualise multivariate data, for this
particular scenario.

The work is related to outlier detection methods \citep[see,][for
example]{filzmoser2018}, particularly those that use robust statistics,
as illustrated in the weather example. Methods discussed in
\citet{directional-outlyingness} and \citet{donoho1982} describe
detecting outlyingness using projections of the data. When these
projections are collected and used as a large set, they define a
high-dimensional confidence region of an indeterminate shape. There is
no analytical definition. However, we could explore the data relative to
the high-dimensional shapes using the same approach described in
Section~\ref{sec-background}. You would generate points on the surface
of the irregular shape, overlay the data on this to visualise with a
tour.

The methods on directional outlyingness or Stahel-Donoho outlyingness,
described above, lend themselves to new potential \bD{} projection
pursuit indexes. These would integrate nicely into a \bD{} projection
pursuit guided tour to interactively visualise the potential outliers
relative to the rest of the sample.

Another potential direction of this work is with model-based clustering
using Gaussian mixtures \citep{FR02}, where ellipses form the basis of
the model. Currently, the \texttt{mclust} software \citep{mclust} has
the capacity to show \gD{} ellipses for two variables, or axis parallel
\gD{} ellipses for \pD{}. The equations developed here for drawing the
\gD{} projection of a \pD{} ellipse would provide more versatile
visualisation for examining the model-based clustering fits.

\section*{Acknowledgements}\label{acknowledgements}
\addcontentsline{toc}{section}{Acknowledgements}

The work of first author Calvi was supported by the ResearchFirst
undergraduate research program at Monash University. German Valencia
advised on the project, in relation to physics applications.

The full paper, code and data to reproduce the work, are publicly
available at https://github.com/uschiLaa/anomaly\_ppi.


  \bibliography{bibliography.bib}


\end{document}
